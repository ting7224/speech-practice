<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ä¸­æ–‡å£èªå³æ™‚æ¯”å°å°ç¨‹å¼</title>
  <style>
    body {
      font-family: "Microsoft JhengHei", Arial, sans-serif;
      background: #fafafa;
      margin: 0;
      padding: 20px;
    }
    .container {
      max-width: 800px;
      margin: 0 auto;
      background: white;
      padding: 20px;
      border-radius: 12px;
      box-shadow: 0 0 10px rgba(0,0,0,0.1);
    }
    h1 {
      text-align: center;
      color: #333;
    }
    select, button {
      padding: 8px 12px;
      margin: 5px;
      font-size: 16px;
    }
    .sentence {
      font-size: 20px;
      text-align: center;
      margin: 20px 0;
      padding: 10px;
      background: #f1f1f1;
      border-radius: 8px;
    }
    #result, #diff {
      padding: 10px;
      margin-top: 10px;
      background: #f9f9f9;
      border: 1px solid #ddd;
      min-height: 30px;
    }
    .highlight {
      background: yellow;
      font-weight: bold;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>ä¸­æ–‡å£èªå³æ™‚æ¯”å°</h1>

    <label for="topic">é¸æ“‡ä¸»é¡Œï¼š</label>
    <select id="topic">
      <option value="school">å­¸æ ¡</option>
      <option value="transport">äº¤é€š</option>
      <option value="shopping">è³¼ç‰©</option>
      <option value="food">é¤é£²</option>
      <option value="housing">ä½å®¿</option>
    </select>
    <button onclick="newSentence()">æ›ä¸€å¥</button>

    <div class="sentence" id="sentence">è«‹æŒ‰ã€Œæ›ä¸€å¥ã€ç”Ÿæˆå¥å­</div>

    <button onclick="playSentence()">ğŸ”Š ç¤ºç¯„ç™¼éŸ³</button>
    <button onclick="startRecognition()">ğŸ™ï¸ é–‹å§‹éŒ„éŸ³</button>

    <h3>è¾¨è­˜çµæœï¼š</h3>
    <div id="result">å°šç„¡çµæœ</div>

    <h3>å·®ç•°é«˜å…‰ï¼š</h3>
    <div id="diff">å°šç„¡çµæœ</div>

    <h3>æ­£ç¢ºç‡ï¼š</h3>
    <div id="accuracy">â€”</div>
  </div>

<script>
  const sentences = {
    school: [
      "è«‹å•æ•™å‹™è™•åœ¨å¹¾æ¨“ï¼Œæˆ‘è¦è¾¦ç†åŠ é€€é¸",
      "åœ–æ›¸é¤¨ä»Šå¤©é–‹åˆ°å¹¾é»ï¼Œæˆ‘æƒ³å€Ÿåƒè€ƒæ›¸",
      "ä¸‹é€±çš„å°çµ„å ±å‘Šéœ€è¦ä¸Šè‡ºç°¡å ±ååˆ†é˜"
    ],
    transport: [
      "åˆ°è‡ºåŒ—è»Šç«™è¦æ›å“ªä¸€æ¢æ·é‹ç·š",
      "å…¬è»Šåˆ°ç«™è«‹å¾å¾Œé–€ä¸‹è»Šä¸è¦æ“ ",
      "æ©Ÿå ´å¿«ç·šæœ«ç­è»Šæ˜¯æ™šä¸Šåä¸€é»"
    ],
    shopping: [
      "é€™ä»¶å¤–å¥—æœ‰æ²’æœ‰å°ä¸€è™Ÿçš„å°ºå¯¸",
      "ç‰¹åƒ¹å•†å“å”®å‡ºæ•ä¸é€€æ›è«‹ç•™æ„",
      "çµå¸³å¯ä»¥ä½¿ç”¨è¡Œå‹•æ”¯ä»˜å’Œç™¼ç¥¨è¼‰å…·"
    ],
    food: [
      "è«‹ä¸è¦é¦™èœè¬è¬å¦å¤–åŠ ä¸€é»è¾£",
      "å…§ç”¨é‚„æ˜¯å¤–å¸¶éœ€è¦ç™¼ç¥¨å—",
      "é€™é“ç‰›è‚‰éºµå¯ä»¥èª¿æ•´éºµæ¢è»Ÿç¡¬"
    ],
    housing: [
      "ç§Ÿå±‹åˆç´„æœ€çŸ­éœ€ä¸€å¹´å¯å¦æ¥å—",
      "æ°´é›»å¦è¨ˆæ¯æœˆç®¡ç†è²»äº”ç™¾å…ƒ",
      "æŠ¼é‡‘å…©å€‹æœˆé€€ç§Ÿæ™‚æœƒé»äº¤"
    ]
  };

  let currentSentence = "";

  function newSentence() {
    const topic = document.getElementById("topic").value;
    const list = sentences[topic];
    currentSentence = list[Math.floor(Math.random() * list.length)];
    document.getElementById("sentence").innerText = currentSentence;
    document.getElementById("result").innerText = "å°šç„¡çµæœ";
    document.getElementById("diff").innerText = "å°šç„¡çµæœ";
    document.getElementById("accuracy").innerText = "â€”";
  }

  // ç¤ºç¯„ç™¼éŸ³
  function playSentence() {
    if (!currentSentence) {
      alert("è«‹å…ˆç”Ÿæˆå¥å­ï¼");
      return;
    }
    const utterance = new SpeechSynthesisUtterance(currentSentence);
    utterance.lang = "zh-TW";
    speechSynthesis.speak(utterance);
  }

  // èªéŸ³è¾¨è­˜
  function startRecognition() {
    if (!('webkitSpeechRecognition' in window)) {
      alert("æ­¤ç€è¦½å™¨ä¸æ”¯æ´èªéŸ³è¾¨è­˜ï¼Œè«‹ä½¿ç”¨ Chromeã€‚");
      return;
    }
    const recognition = new webkitSpeechRecognition();
    recognition.lang = "zh-TW";
    recognition.continuous = false;
    recognition.interimResults = false;

    recognition.start();
    recognition.onresult = function(event) {
      const resultText = event.results[0][0].transcript;
      document.getElementById("result").innerText = resultText;
      compareText(currentSentence, resultText);
    };
  }

  // æ¯”å°æ–‡å­—ä¸¦é«˜å…‰éŒ¯èª¤
  function compareText(target, spoken) {
    let diffHtml = "";
    let correctCount = 0;
    const minLen = Math.min(target.length, spoken.length);
    for (let i = 0; i < minLen; i++) {
      if (target[i] === spoken[i]) {
        diffHtml += target[i];
        correctCount++;
      } else {
        diffHtml += `<span class="highlight">${spoken[i]}</span>`;
      }
    }
    if (spoken.length > target.length) {
      diffHtml += `<span class="highlight">${spoken.slice(target.length)}</span>`;
    }
    document.getElementById("diff").innerHTML = diffHtml;
    const accuracy = Math.round((correctCount / target.length) * 100);
    document.getElementById("accuracy").innerText = accuracy + "%";
  }
</script>
</body>
</html>
